use strict;
use warnings;
use utf8;
use Test::More;
use FindBin ();
use lib "$FindBin::Bin/../lib";
use Lingua::JA::NormalizeText;
use Munou::Twitter::NormalizeText qw/unify_warai  unify_url  strip_hashtag  strip_kao
aaaa2aaa  ore2watashi  unify_kakko  unify_3dots  unify_kutouten  strip_pictograph  etc/;

binmode Test::More->builder->$_ => ':utf8'
    for qw/output failure_output todo_output/;

subtest 'unify_warai' => sub {
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—"), "ã‚ªã‚¦ãƒ• \x{1F60A} ");
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—ï½—"), "ã‚ªã‚¦ãƒ• \x{1F60A} ");
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—ï½—ï½—"), "ã‚ªã‚¦ãƒ• \x{1F60A} ");
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—ï½—ï½—ï½—"), "ã‚ªã‚¦ãƒ• Ê¬ ");
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—ï½—ï½—ï½—ãƒ‰ãƒ¥ãƒ•ï½—ã‚³ãƒã‚©www"), "ã‚ªã‚¦ãƒ• Ê¬ ãƒ‰ãƒ¥ãƒ• \x{1F60A} ã‚³ãƒã‚© \x{1F60A}");
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—ï½—ï½—ï½—ãƒ‰ãƒ¥ãƒ•ï½—ã‚³ãƒã‚©wwww"), "ã‚ªã‚¦ãƒ• Ê¬ ãƒ‰ãƒ¥ãƒ• \x{1F60A} ã‚³ãƒã‚© Ê¬ ");
    is(unify_warai("ã‚ªã‚¦ãƒ•ï½—ï½—ï½—ï½— ãƒ‰ãƒ¥ãƒ•ï½— ã‚³ãƒã‚©wwww"), "ã‚ªã‚¦ãƒ• Ê¬  ãƒ‰ãƒ¥ãƒ• \x{1F60A}  ã‚³ãƒã‚© Ê¬ ");
    is(unify_warai("ã‚ªã‚¦ãƒ• ï½—"), "ã‚ªã‚¦ãƒ•  \x{1F60A} ");
    is(unify_warai("ã‚ªã‚¦ãƒ• ï½—ï½—"), "ã‚ªã‚¦ãƒ•  \x{1F60A} ");
    is(unify_warai("ã‚ªã‚¦ãƒ• ï½–"), "ã‚ªã‚¦ãƒ• ï½–");
    is(unify_warai("ã‚ªã‚¦ãƒ• ï½–ï½–"), "ã‚ªã‚¦ãƒ• ï½–ï½–");
    is(unify_warai("ã†ã¯w"), "ã†ã¯ \x{1F60A}");
    is(unify_warai("ã†ã¯ww"), "ã†ã¯ \x{1F60A}");
    is(unify_warai("ã†ã¯wwwwwww"), "ã†ã¯ Ê¬ ");
    is(unify_warai("ã†ã¯v"), "ã†ã¯v");
    is(unify_warai("ã†ã¯vv"), "ã†ã¯vv");
    is(unify_warai("ã†ã¯wwwwwwãŠãµww"), "ã†ã¯ Ê¬ ãŠãµ \x{1F60A}");
    is(unify_warai("ã†ã¯vvvvvvãŠãµvv"), "ã†ã¯ Ê¬ ãŠãµvv");
    is(unify_warai("ã†ã¯vvvvvvãŠãµvvv"), "ã†ã¯ Ê¬ ãŠãµvvv");
    is(unify_warai("ã†ã¯vvvvvvãŠãµvvvv"), "ã†ã¯ Ê¬ ãŠãµ Ê¬ ");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬Ê¬"), "ã‚¦ã‚§ãƒ¼ã‚¤ \x{1F60A} ");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬Ê¬Ê¬Ê¬Ê¬"), "ã‚¦ã‚§ãƒ¼ã‚¤ Ê¬ ");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬Ê¬Ê¬Ê¬Ê¬" x 2), "ã‚¦ã‚§ãƒ¼ã‚¤ Ê¬ " x 2);
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤ï½—ï½—ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ \x{1F60A} ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤ï½—ï½—ï½—ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ \x{1F60A} ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤ï½—ï½—ï½—ï½—ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ Ê¬ ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤ï½–ï½–ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ï½–ï½–ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤ï½–ï½–ï½–ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ï½–ï½–ï½–ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤ï½–ï½–ï½–ï½–ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ Ê¬ ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã“ã‚Œã¯w"), "ã“ã‚Œã¯ \x{1F60A}");
    is(unify_warai("ã“ã‚Œã¯wã§ã™"), "ã“ã‚Œã¯wã§ã™");
    is(unify_warai("ã‚„ã£ã±wã§ã™ã­"), "ã‚„ã£ã±wã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±wwã§ã™ã­"), "ã‚„ã£ã±wwã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±wwwã§ã™ã­"), "ã‚„ã£ã±wwwã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±wwwwã§ã™ã­"), "ã‚„ã£ã± Ê¬ ã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±vã§ã™ã­"), "ã‚„ã£ã±vã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±vvã§ã™ã­"), "ã‚„ã£ã±vvã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±vvvã§ã™ã­"), "ã‚„ã£ã±vvvã§ã™ã­");
    is(unify_warai("ã‚„ã£ã±vvvvã§ã™ã­"), "ã‚„ã£ã± Ê¬ ã§ã™ã­");
    is(unify_warai("abwcd"), "abwcd");
    is(unify_warai("ABWCD"), "ABWCD");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ \x{1F60A} ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬Ê¬ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ \x{1F60A} ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬Ê¬Ê¬ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ \x{1F60A} ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("ã‚¦ã‚§ãƒ¼ã‚¤Ê¬Ê¬Ê¬Ê¬ã‚¦ã‚§ãƒ¼ã‚¤"), "ã‚¦ã‚§ãƒ¼ã‚¤ Ê¬ ã‚¦ã‚§ãƒ¼ã‚¤");
    is(unify_warai("wwwã‚µãƒ¼ãƒ"), "wwwã‚µãƒ¼ãƒ");
    is(unify_warai("WWWã‚µãƒ¼ãƒ"), "WWWã‚µãƒ¼ãƒ");
    is(unify_warai("wã‚µãƒ¼ãƒ"), "wã‚µãƒ¼ãƒ");
    is(unify_warai("wwã‚µãƒ¼ãƒ"), "wwã‚µãƒ¼ãƒ");
    is(unify_warai("vvvã‚µãƒ¼ãƒ"), "vvvã‚µãƒ¼ãƒ");
    is(unify_warai("VVVã‚µãƒ¼ãƒ"), "VVVã‚µãƒ¼ãƒ");
    is(unify_warai("vã‚µãƒ¼ãƒ"), "vã‚µãƒ¼ãƒ");
    is(unify_warai("vvã‚µãƒ¼ãƒ"), "vvã‚µãƒ¼ãƒ");
    is(unify_warai("abcw"), "abcw");
    is(unify_warai("abcv"), "abcv");
    is(unify_warai("ã‚„ã£ã»ãƒ¼wwwwæš‡"), "ã‚„ã£ã»ãƒ¼ Ê¬ æš‡");
    is(unify_warai("ğŸ˜Š" x 2), "");
};

subtest 'unify_url' => sub {
    is(unify_url("ã“ã‚Œ http://www.yahoo.co.jp/"), "ã“ã‚Œ XXXURLXXX");
    is(unify_url("ã“ã‚Œ https://www.yahoo.co.jp/"), "ã“ã‚Œ XXXURLXXX");
    is(unify_url("ã“ã‚Œ http://www.yahoo.co.jp/hoge"), "ã“ã‚Œ XXXURLXXX");
    is(unify_url("ã“ã‚Œ http://www.yahoo.co.jp/%20"), "ã“ã‚Œ XXXURLXXX");
    is(unify_url("ã“ã‚Œ http://www.yahoo.co.jp/%20 ã‚„ã§"), "ã“ã‚Œ XXXURLXXX ã‚„ã§");
    is(unify_url("ã“ã‚Œhttp://www.yahoo.co.jp/ã‚„ã§"), "ã“ã‚ŒXXXURLXXX");
    is(unify_url("ã“ã‚Œ http://www.yahoo.co.jp/ ã‚„ã§" x 2), "ã“ã‚Œ XXXURLXXX ã‚„ã§" x 2);
};

subtest 'strip_hashtag' => sub {
    is(strip_hashtag("å‹ã£ãŸ #giants"), "å‹ã£ãŸ  ");
    is(strip_hashtag("å‹ã£ãŸ #å·¨äºº"), "å‹ã£ãŸ  ");
    is(strip_hashtag("#ã«ã‚ƒãƒ¼ å‹ã£ãŸ #å·¨äºº"), "  å‹ã£ãŸ  ");
    is(strip_hashtag("å‹ã£ãŸ#å·¨äºº"), "å‹ã£ãŸ ");
};

subtest 'strip_kao' => sub {
    is(strip_kao("(ï½¥à¸±Ï‰ï½¥à¸±ï¼‰"), "");
    is(strip_kao("^^;"), "");
    is(strip_kao("(^^ã‚"), "");
    is(strip_kao("â˜†å½¡"), "");
    is(strip_kao("(^O^)"), "");
    is(strip_kao("m(__)m"), "");
    is(strip_kao("(ãƒ»Ï‰<)"), "");
    is(strip_kao("ãƒ¤ãƒƒãƒ›ãƒ¼ (^O^)"), "ãƒ¤ãƒƒãƒ›ãƒ¼");
    is(strip_kao("ãƒ¤ãƒƒãƒ›ãƒ¼ (^O^) ã«ã‚ƒ"), "ãƒ¤ãƒƒãƒ›ãƒ¼ ã«ã‚ƒ");
    is(strip_kao("ã‚¤ã‚¨ãƒ¼ã‚¤ (^O^)ï¾”ï½¯ï¾ï½°"), "ã‚¤ã‚¨ãƒ¼ã‚¤");
    is(strip_kao("ã‚¤ã‚¨ãƒ¼ã‚¤ (^O^) ï¾”ï½¯ï¾ï½°"), "ã‚¤ã‚¨ãƒ¼ã‚¤");
    is(strip_kao("ä¸€æ—¥é ‘å¼µã‚ã†ã­ï¼Î¾(ï½€â—‹Ï‰â—‹Â´)"), "ä¸€æ—¥é ‘å¼µã‚ã†ã­ï¼");
    is(strip_kao("ä¸€æ—¥é ‘å¼µã‚ã†ã­ï¼Î¾(ï½€â—‹Ï‰â—‹Â´"), "ä¸€æ—¥é ‘å¼µã‚ã†ã­ï¼");
    is(strip_kao("è·ç‰©ãŒãŠã‚‚ã„(Â´ï½¥_ï½¥`)ç¬‘"), "è·ç‰©ãŒãŠã‚‚ã„ \x{1F60A}");
    is(strip_kao("ãˆã€ãƒ€ãƒ¡ãªã®ï¾Ÿ(ï¾ŸÂ´Ğ”ï½€ï¾Ÿ)ï¾Ÿï½¡"), "ãˆã€ãƒ€ãƒ¡ãªã®");
    is(strip_kao("ãˆã€ãƒ€ãƒ¡ãªã®ï¾Ÿ(ï¾ŸÂ´Ğ”ï½€ï¾Ÿ)ï¾Ÿï½¡"), "ãˆã€ãƒ€ãƒ¡ãªã®");
    is(strip_kao("ãã‚“ã¡ã‚‡ã†ã ãª... (à¸‡ â€¢Ì€_â€¢Ì)à¸‡ãŒã‚“ã°ã£ã¦"), "ãã‚“ã¡ã‚‡ã†ã ãª ãŒã‚“ã°ã£ã¦");
    is(strip_kao("ãŠæ—©ã†ã”ã–ã„ã¾ã™ã€‚(ï¿£â–½ï¿£)ãƒ ãƒ‘ãƒ¯ãƒ¼å…¨é–‹ï¼"), "ãŠæ—©ã†ã”ã–ã„ã¾ã™ ãƒ‘ãƒ¯ãƒ¼å…¨é–‹ï¼");
    is(strip_kao("ãŠã¯ã‚ˆãƒ¼ã§ã™(^o^)ï¼ ä»Šæ—¥ã‚‚"), "ãŠã¯ã‚ˆãƒ¼ã§ã™ ä»Šæ—¥ã‚‚");
    is(strip_kao("åƒç”°!!!!! (ã€ãƒ»Ï‰ãƒ»)ã‚ˆ!!"), "åƒç”°!!!!! ã‚ˆ!!");
    is(strip_kao("ãŠã‰ã€œï¼ç¬‘"), "ãŠã‰ã€œï¼ \x{1F60A}");
    is(strip_kao("ãŠã¯ã‚ˆã†ã«ã‚ƒãƒ¼â™ª"), "ãŠã¯ã‚ˆã†ã«ã‚ƒãƒ¼");
    is(strip_kao("è¡Œã£ã¦ãã¾ã™(*^^*)"), "è¡Œã£ã¦ãã¾ã™");
    is(strip_kao("å‚ã‚Šã¾ã—ãŸ( Â´ â–½ ` )ï¾‰ ç›¸äº’å¸Œæœ›ãªã®ã§"), "å‚ã‚Šã¾ã—ãŸ ç›¸äº’å¸Œæœ›ãªã®ã§");
    is(strip_kao("ãŠã¯ã‚ˆã†ï¼¼(^o^)ï¼ã‚„ã°ã„ã­"), "ãŠã¯ã‚ˆã† ã‚„ã°ã„ã­");
    is(strip_kao("ã”ã–ã„ã¾ã™(ï¼ŠË™OË™ï¼Š)ã‚„ã°ã„ã§"), "ã”ã–ã„ã¾ã™ ã‚„ã°ã„ã§");
    is(strip_kao("ã¾ã™(^O^)ï¼"), "ã¾ã™");
    is(strip_kao("(`ï½¥Ï‰ï½¥)ã‚ãŠã¯ã‚ˆ"), "ãŠã¯ã‚ˆ");
    is(strip_kao("ã”ã–ã„ã¾ã™Ù©(*Â´ï¸¶`*)Û¶â™¬"), "ã”ã–ã„ã¾ã™");
    is(strip_kao("ãŠã£ã¯ã‚ˆãƒ¼ãƒ¾(ï¼ âŒ’ãƒ¼âŒ’ï¼ )ãƒ"), "ãŠã£ã¯ã‚ˆãƒ¼");
    is(strip_kao("ã¾ã™âŠ‚((ãƒ»xãƒ»))âŠƒ http"), "ã¾ã™ http");
    is(strip_kao("(*Â´âˆ€`*)ï¾‰ï½µï¾Šï¾–ï½³â™ªã‘ã¿ã•ã‚“"), "ã‘ã¿ã•ã‚“");
    is(strip_kao("å¼Ÿï¼Ÿ(ï¾Ÿâˆ€ï¾Ÿ)"), "å¼Ÿï¼Ÿ");
    is(strip_kao("å¼Ÿ?(ï¾Ÿâˆ€ï¾Ÿ)"), "å¼Ÿ?");
    is(strip_kao("ã”ã–ã„ã¾ã™Ù©(à¹‘â›á´—â›à¹‘)Û¶æœã¯ã¾ã "), "ã”ã–ã„ã¾ã™ æœã¯ã¾ã ");
    is(strip_kao("ã“ã®ã”æ©ã‚ä»‡ã§è¿”ã—ã¾ã™ç¬‘"), "ã“ã®ã”æ©ã‚ä»‡ã§è¿”ã—ã¾ã™ \x{1F60A}");
    is(strip_kao("ãŒã‚“ã°ã£ã¦Ù©(ËŠá—œË‹*)Ùˆ"), "ãŒã‚“ã°ã£ã¦");
    is(strip_kao("ãŠã¯ã‚ˆãƒ¼Â°â‚ŠÂ·Ëˆâˆ—((  à¥£ËƒÌ¶á·‡ â€§Ì« Ë‚Ì¶á·† à¥£))âˆ—Ëˆâ€§â‚ŠÂ°"), "ãŠã¯ã‚ˆãƒ¼");
    is(strip_kao("ã¤ãƒ¼ãƒ¼ãƒ¼â™ªo(^o^)o"), "ã¤ãƒ¼ãƒ¼ãƒ¼");
    is(strip_kao("ãŠã¯ã‚ã‚Šãƒ¼(*â‰§âˆ‡â‰¦)/"), "ãŠã¯ã‚ã‚Šãƒ¼");
    is(strip_kao("ãŠã¯ã‚ˆãƒ¼ãƒ¾(oÂ´âˆ€ï½€o)ï¾‰ ãã£ã¡ã¯"), "ãŠã¯ã‚ˆãƒ¼ ãã£ã¡ã¯");
    is(strip_kao("å…¥å­¦å¼( :D)â”¸â”“ï¾œï½§ï½°"), "å…¥å­¦å¼");
    #is(strip_kao("ï½(^Ï‰^)ã€‡ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‡(^Ï‰^)ï½ "), "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™");
    is(strip_kao("ãŠã¯ãŠãƒ¾(âŒ’(ï¾‰'Ï‰')ï¾‰"), "ãŠã¯ãŠ");
    is(strip_kao("ã‚ã‚ŠãŒã¨ã†\( Ë†oË† )/ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼æ¥½ã—ã‚“ã§â™¡"), "ã‚ã‚ŠãŒã¨ã† ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼æ¥½ã—ã‚“ã§");
    is(strip_kao("ã§ã™ï¼ï¼(ç¬‘)ã§ã‚‚"), "ã§ã™ï¼ï¼ \x{1F60A} ã§ã‚‚");
    is(strip_kao("ã§ã™ï¼ï¼ã§ã‚‚//// ã„ã‚„"), "ã§ã™ï¼ï¼ã§ã‚‚ ã„ã‚„");
    is(strip_kao("ã€æ‹¡æ•£å¸Œæœ›ã€‘ã§ã™"), "ã§ã™");
    is(strip_kao("ã§ã™b ã„ãˆã„"), "ã§ã™ ã„ãˆã„");
};

subtest 'aaaa2aaa' => sub {
    is(aaaa2aaa("ãã‚ƒãƒ¼"), "ãã‚ƒãƒ¼");
    is(aaaa2aaa("ãã‚ƒãƒ¼ãƒ¼"), "ãã‚ƒãƒ¼ãƒ¼");
    is(aaaa2aaa("ãã‚ƒãƒ¼ãƒ¼ãƒ¼"), "ãã‚ƒãƒ¼ãƒ¼ãƒ¼");
    is(aaaa2aaa("ãã‚ƒãƒ¼ãƒ¼ãƒ¼ãƒ¼"), "ãã‚ƒãƒ¼ãƒ¼ãƒ¼");
    is(aaaa2aaa("ãã‚ƒãƒ¼ãƒ¼ãƒ¼ãƒ¼" x 2), "ãã‚ƒãƒ¼ãƒ¼ãƒ¼" x 2);
    is(aaaa2aaa("!!"), "!!");
    is(aaaa2aaa("!!!"), "!!");
    is(aaaa2aaa("Yeah!!!!" x 2), "Yeah!!" x 2);
    is(aaaa2aaa("Yeah!!!!OOOOQQPOPOPOP" x 2), "Yeah!!OOOQQPOPOPOP" x 2);
};

subtest 'ore2watashi' => sub {
    is(ore2watashi("ä¿ºæµ"), "ç§æµ");
    is(ore2watashi("ä¿ºæµ" x 2), "ç§æµ" x 2);
};

subtest 'unify_kakko' => sub {
    is(unify_kakko("ã€ã‚ã‚ã‚ã€"), "ã€Œã‚ã‚ã‚ã€");
    is(unify_kakko("ã€ã‚ã‚ã‚ã€" x 2), "ã€Œã‚ã‚ã‚ã€" x 2);
};

subtest 'unify_3dots' => sub {
    is(unify_3dots("ãˆã€‚ã€‚ã€‚"), "ãˆâ€¦â€¦");
    is(unify_3dots("ãˆâ€¦"), "ãˆâ€¦â€¦");
    is(unify_3dots("ã»ã€ã€ã€ã€ã€ã€ãˆã€‚ã€‚"), "ã»â€¦â€¦ãˆâ€¦â€¦");
    is(unify_3dots("ã»â€¦â€¦â€¦â€¦"), "ã»â€¦â€¦â€¦â€¦");
};

subtest 'unify_kutouten' => sub {
    is(unify_kutouten("ã‚ã‚ï¼Œï¼Œ"), "ã‚ã‚ã€ã€");
    is(unify_kutouten("ã„ã„ï¼Œï¼Œã†ã†,."), "ã„ã„ã€ã€ã†ã†ã€ã€‚");
};

subtest 'strip_pictograph' => sub {
    is(strip_pictograph("\x{1F4A9}" x 2), "");
};

subtest 'combination' => sub {
    local $_ = Lingua::JA::NormalizeText->new([
        'remove_controls',       'remove_DFC',              \&unify_url,
        'decode_entities',       'decode_entities',         \&strip_hashtag,
        \&unify_warai,           \&strip_pictograph,        \&ore2watashi,
        'wavetilde2long',        'fullminus2long',          'dashes2long',
        'drawing_lines2long',    \&unify_kakko,             'unify_whitespaces',
        'nl2space',              'tab2space',               \&unify_3dots,
        \&unify_kutouten,        \&strip_kao,               'space_z2h',
        'trim',                  'unify_long_spaces',       'alnum_z2h',  'lc',
        'katakana_h2z',          'square2katakana',         'circled2kanji',
        'circled2kana',          'all_dakuon_normalize',    'decompose_parenthesized_kanji',
        \&aaaa2aaa,              \&etc,
    ]);

    is($_->normalize("ï¼ˆã‚ã‚ã‚ï¼‰"), "");
    is($_->normalize("ãŠé‡‘ã¨æ™‚é–“ã‚’ç„¡é§„ã«ã—ãŸæ°—åˆ†åŠç«¯ãªã‹ã£ãŸwã»ã‚“ã¨ã‚‚ã†å°‘ã—ã¡ã‚ƒã‚“ã¨ã¿ã¦ãã‚Œã¦ã‚‚ã‚ˆã‹ã£ãŸã®ã«â€¦"), "ãŠé‡‘ã¨æ™‚é–“ã‚’ç„¡é§„ã«ã—ãŸæ°—åˆ†åŠç«¯ãªã‹ã£ãŸwã»ã‚“ã¨ã‚‚ã†å°‘ã—ã¡ã‚ƒã‚“ã¨ã¿ã¦ãã‚Œã¦ã‚‚ã‚ˆã‹ã£ãŸã®ã«â€¦â€¦");
    is($_->normalize("ãŠã¯ã‚ˆã€œã”ã–ã„ã¾ã™â™ªè‡ªåˆ†ç™ºä¿¡ã§ã™ã‹ï¼Ÿ(ç¬‘)"), "ãŠã¯ã‚ˆãƒ¼ã”ã–ã„ã¾ã™â™ªè‡ªåˆ†ç™ºä¿¡ã§ã™ã‹? \x{1F60A}");
    is($_->normalize("ã†ã£ã€è»Šå†…ãŒãƒ‹ãƒ³ãƒ‹ã‚¯è‡­ã„ã€‚ãŠã°ã‚ˆã‚”ã”ã–ã‚Šã¾ãšã‚‹"), "ã†ã£ã€è»Šå†…ãŒãƒ‹ãƒ³ãƒ‹ã‚¯è‡­ã„ã€‚ãŠã°ã‚ˆã‚”ã”ã–ã‚Šã¾ãšã‚‹");
    is($_->normalize("ä»Šæ—¥ã‚‚å…ƒæ°—ã«ç¤¾ç•œãƒ©ã‚¤ãƒ•â˜† æœã¯ãã‚“ãªã‚»ãƒƒãƒˆãŒã‚ã‚‹ã‚“ã‚„ã­ã€œ"), "ä»Šæ—¥ã‚‚å…ƒæ°—ã«ç¤¾ç•œãƒ©ã‚¤ãƒ• æœã¯ãã‚“ãªã‚»ãƒƒãƒˆãŒã‚ã‚‹ã‚“ã‚„ã­ãƒ¼");
    is($_->normalize("ã¡ã‚…ã£ã¡ã‚…ã•ã‚ŒãŸã‹ã‚‰ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼"), "ã¡ã‚…ã£ã¡ã‚…ã•ã‚ŒãŸã‹ã‚‰!!");
    is($_->normalize("ãƒ¢ãƒ³ã‚¹ãƒˆã‚„ã£ã¦ã‚‹ã®(*Â´Ï‰ï½€*)ï¼Ÿ"), "ãƒ¢ãƒ³ã‚¹ãƒˆã‚„ã£ã¦ã‚‹ã®?");
    is($_->normalize("ã‚„ã£ã¦ã‚‹ã‚ˆã‚“(=ï¾ŸÏ‰ï¾Ÿ)ï¾‰ãã‚Œã»ã©ãƒãƒã£ã¦ã¯ç„¡ã„ã‘ã©ã­w"), "ã‚„ã£ã¦ã‚‹ã‚ˆã‚“ ãã‚Œã»ã©ãƒãƒã£ã¦ã¯ç„¡ã„ã‘ã©ã­ \x{1F60A}");
    is($_->normalize("ã¯ã‚ï¼Ÿ"), "ã¯ã‚?");
    is($_->normalize("ã—ã‹ã—16æ™‚ã”ã‚ã«ã¯å¤§å¡šãªã®ã§ç„¡ç†ã§ã™ãªãƒ¼(ï¿£â–½ï¿£)"), "ã—ã‹ã—16æ™‚ã”ã‚ã«ã¯å¤§å¡šãªã®ã§ç„¡ç†ã§ã™ãªãƒ¼");
    is($_->normalize("ãˆã¸â™¡ "), "ãˆã¸");
    is($_->normalize("ã¿ã‚†ã¡ã‚ƒã‚“ãƒ•ã‚¡ã‚¤ãƒˆãƒ¼â™ª Ù©( Â´Ï‰` )Ùˆ â™ª"), "ã¿ã‚†ã¡ã‚ƒã‚“ãƒ•ã‚¡ã‚¤ãƒˆãƒ¼");
    is($_->normalize("ä¸€æ™‚é™ç›®ãŒæ•‘æ€¥åŒ»å­¦ãªã‚“ã§ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã‚ãŒã‚Šã¾ãã‚Šã€‚ã‚„ã£ã¨ç§ãŒåŒ»å­¦éƒ¨ã‚’å¿—æœ›ã—ãŸåŸç‚¹ã«è¾¿ã‚Šç€ã„ãŸã€‚    \n     â€¦ã§ã‚‚é…åˆ»ã—ãã†(Â´ï¼›Ï‰ï¼›ï½€)"), "ä¸€æ™‚é™ç›®ãŒæ•‘æ€¥åŒ»å­¦ãªã‚“ã§ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã‚ãŒã‚Šã¾ãã‚Šã€‚ã‚„ã£ã¨ç§ãŒåŒ»å­¦éƒ¨ã‚’å¿—æœ›ã—ãŸåŸç‚¹ã«è¾¿ã‚Šç€ã„ãŸ â€¦â€¦ã§ã‚‚é…åˆ»ã—ãã†");
    is($_->normalize("ãƒ•ã‚©ãƒ­ãƒã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™â™¡ã§ã¯ã‚¿ãƒ¡ã§è©±ã—ã¾ã™ã­ãƒ¼*\(^o^)/* ä½•ã¦å‘¼ã‚“ã ã‚‰ã„ã„ã‹ãª?â™¡â™¡"), "ãƒ•ã‚©ãƒ­ãƒã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ ã§ã¯ã‚¿ãƒ¡ã§è©±ã—ã¾ã™ã­ãƒ¼ ä½•ã¦å‘¼ã‚“ã ã‚‰ã„ã„ã‹ãª?");
    is($_->normalize("ã¿ã‚“ãªã‹ã‚‰ã¯ã€ã‚ã“ã¡ã‚ƒã‚“ã£ã¦å‘¼ã°ã‚Œã¦ã‚‹ã‚ˆï½â™¡â™¡â™¡ ç§ã¯ãªã‚“ã¦å‘¼ã‚“ã ã‚‰ã„ã„(ã¤Ï‰`*)ï¼Ÿï¼Ÿ"), "ã¿ã‚“ãªã‹ã‚‰ã¯ã€ã‚ã“ã¡ã‚ƒã‚“ã£ã¦å‘¼ã°ã‚Œã¦ã‚‹ã‚ˆãƒ¼ ç§ã¯ãªã‚“ã¦å‘¼ã‚“ã ã‚‰ã„ã„??");
    is($_->normalize("YouTubeã®å©ã„ã¦ã¿ãŸè¦‹ã¦ ã‚ç„¶ã¨ã—ãŸã‚†ãªã§ã™( *ãƒ»Ï‰ãƒ»)ãƒ"), "youtubeã®å©ã„ã¦ã¿ãŸè¦‹ã¦ ã‚ç„¶ã¨ã—ãŸã‚†ãªã§ã™");
    is($_->normalize("ãŠä¸–è¾ã§ã‚‚å¬‰ã—ã„ã§ã™ç¬‘ ä¸­èº«ãŒããšã ã‹ã‚‰ "), "ãŠä¸–è¾ã§ã‚‚å¬‰ã—ã„ã§ã™ \x{1F60A} ä¸­èº«ãŒããšã ã‹ã‚‰");
    is($_->normalize("ï½µï¾Šï¾–â”€ãƒ½(ï½¥âˆ€ï½¥`o)(oÂ´ï½¥âˆ€ï½¥`o)(oÂ´ï½¥âˆ€ï½¥)ï¾‰â”€ï½©â™ª"), "ã‚ªãƒãƒ¨ãƒ¼ oÂ´ãƒ»âˆ€ãƒ»`o");
    is($_->normalize("ã¶ãƒ¼ãŸã£ã¦ã€‚ç¬‘"), "ã¶ãƒ¼ãŸã£ã¦ \x{1F60A}");
    is($_->normalize("ã¾ã¾ã‚“ãŒå‹æ‰‹ã«åå‰ã¤ã‘ãŸã®(Â´ï½¥_ï½¥`)ç¬‘"), "ã¾ã¾ã‚“ãŒå‹æ‰‹ã«åå‰ã¤ã‘ãŸã® \x{1F60A}");
    is($_->normalize("ã‚«ãƒ¯ã‚¦ã‚½ã‰ã‰ã‰ã‰ã‰ã‰ã‰ã‰ï¼ï¼ï¼ï¼ã‹ã‚ã„ã„ï¼ï¼ã“ã„ã¤ã‚‰ã‹ã‚ã„ã„ï¼ï¼ï¼"), "ã‚«ãƒ¯ã‚¦ã‚½ã‰ã‰ã‰!!ã‹ã‚ã„ã„!!ã“ã„ã¤ã‚‰ã‹ã‚ã„ã„!!");
    is($_->normalize("ãŠã‚„ã¤æ¢ã—ã¦ã‚‹ã ã‘ã ã‹ã‚‰KENZENã ãƒ¼ã¨ä¸»å¼µã—ã¦ã¿ã‚‹ï¼ˆç¬‘é¡”ï¼‰"), "ãŠã‚„ã¤æ¢ã—ã¦ã‚‹ã ã‘ã ã‹ã‚‰kenzenã ãƒ¼ã¨ä¸»å¼µã—ã¦ã¿ã‚‹");
    is($_->normalize("èª¿ã¹ã¨ãã¾ã™ã‹ã­ã€ã„ã„æ©Ÿä¼šã§ã™ã—ã€‚"), "èª¿ã¹ã¨ãã¾ã™ã‹ã­ã€ã„ã„æ©Ÿä¼šã§ã™ã—");
    is($_->normalize("èª¿ã¹ã¨ãã¾ã™ã‹ã­ã€‚ã„ã„æ©Ÿä¼šã§ã™ã—ã€‚"), "èª¿ã¹ã¨ãã¾ã™ã‹ã­ã€‚ã„ã„æ©Ÿä¼šã§ã™ã—");
    is($_->normalize("ç²¾ã€…æœˆã§ã‚‚çœºã‚ã¦ã¾ã™ã‹ã­ï½â€¦"), "ç²¾ã€…æœˆã§ã‚‚çœºã‚ã¦ã¾ã™ã‹ã­ãƒ¼â€¦â€¦");
    is($_->normalize("å¯é•ãˆãŸ?( á›ğŸ‘)ï¾Šï¾Ÿï½§ å¤§ä¸ˆå¤«â‰ï¸( á›ğŸ‘)ï¾Šï¾Ÿï½§â†é¡”æ–‡å­—ã“ã‚Œã§ã‚‚ã‚ã¡ã‚ƒãã¡ã‚ƒå¿ƒé…ã—ã¦ã‚‹"), "å¯é•ãˆãŸ? å¤§ä¸ˆå¤«!? é¡”æ–‡å­—ã“ã‚Œã§ã‚‚ã‚ã¡ã‚ƒãã¡ã‚ƒå¿ƒé…ã—ã¦ã‚‹");
    is($_->normalize("ç„¡ç†ã—ã†ã ã€œã—ã†ã ã—ã†ã ã€œç„¡ç†ã—ã†ã ã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œã€œ"), "ç„¡ç†ã—ã†ã ãƒ¼ã—ã†ã ã—ã†ã ãƒ¼ç„¡ç†ã—ã†ã ãƒ¼ãƒ¼ãƒ¼");
    is($_->normalize("ãŠã‚ã§ã¨ãƒ¼*\( Ë†oË† )/*"), "ãŠã‚ã§ã¨ãƒ¼");
    is($_->normalize("ã¯ã‚‹ã‹ã¡ã‚ƒã‚“ï¼(ç¬‘) ã‚ã‚ŠãŒã¨ã†â¥â¥â¥ æ¾å¾³ã®å­ã ã‚ˆã­ï¼Ÿ( ï¼¾Ï‰ï¼¾ )"), "ã¯ã‚‹ã‹ã¡ã‚ƒã‚“! \x{1F60A} ã‚ã‚ŠãŒã¨ã† æ¾å¾³ã®å­ã ã‚ˆã­?");
    is($_->normalize("ãŸã‚ã«ã—ã‚ˆ(à¹‘Â°Ï‰Â°à¹‘)â¤â¤ å²©æ©‹ç„æ¨¹æ‹…ã§åŒã„å¹´ã¨ã‹é«˜ã¾ã‚‹ğŸ’—ã‚Šãªç„æ¨¹ãã‚“ã ã£ãŸã®ã­â™¬â™¡ã˜ãã„ã‚ã©ã£ã¡ã‹ãªã£ã¦æ€ã£ãŸã®â€âœ¿"), "ãŸã‚ã«ã—ã‚ˆ å²©æ©‹ç„æ¨¹æ‹…ã§åŒã„å¹´ã¨ã‹é«˜ã¾ã‚‹ã‚Šãªç„æ¨¹ãã‚“ã ã£ãŸã®ã­ ã˜ãã„ã‚ã©ã£ã¡ã‹ãªã£ã¦æ€ã£ãŸã®");
    is($_->normalize("ã‚ã€ãã†ã ï¼ã‚¢ã‚¤ã‚³ãƒ³ã˜ãã„ã‚ã ã‚‚ã‚“ã­ï½—ï½—è¨€ã‚ã‚Œã¦ã¿ã‚Œã°â™¡.Â°â‘…ä¸€è¨€ã«ã¯ç„æ¨¹ãã‚“ã£ã¦æ›¸ã„ãŸã‚‹ğŸ˜‚ğŸ˜‚ğŸ˜‚ï½—ï½—"), "ã‚ã€ãã†ã !ã‚¢ã‚¤ã‚³ãƒ³ã˜ãã„ã‚ã ã‚‚ã‚“ã­ \x{1F60A} è¨€ã‚ã‚Œã¦ã¿ã‚Œã°ã€‚Â°â‘…ä¸€è¨€ã«ã¯ç„æ¨¹ãã‚“ã£ã¦æ›¸ã„ãŸã‚‹ \x{1F60A}");
    is($_->normalize("ã”é£¯é£Ÿã¹ã¦ãã¾ã™ã€œï½¡ï½¥*ï½¥:â‰¡(ã€€Îµ:)"), "ã”é£¯é£Ÿã¹ã¦ãã¾ã™ãƒ¼");
    is($_->normalize("ã‚ã—ã¦ã‚‰ï½ï¼ _(â” ã€ŒÎµ:)_"), "ã‚ã—ã¦ã‚‰ãƒ¼!");
    is($_->normalize("ãˆ??ãã‚“ãªã«é•·ã„ã®â€¦â€¦!?!?ã‚„ã°ã„å¬‰ã—ã™ãã‚‹â€¦â€¦ã£:;(âˆ©Ë™ï¸¶Ë™âˆ©);: â™¡"), "ãˆ??ãã‚“ãªã«é•·ã„ã®â€¦â€¦!?!?ã‚„ã°ã„å¬‰ã—ã™ãã‚‹â€¦â€¦");
    is($_->normalize("ã”ã‚ã‚“ã­(;_;)é–‹å ´ã¨é–‹æ¼”æ™‚é–“è¦‹é–“é•ãˆã¦ãŸã‹ã‚‰ã‚‚ã£ã¨çŸ­ã„ã‚„(;_;)(;_;)ï¼ ãã—ã¦ã‚ã„ã¡ã‚ƒã‚“ã´ã“ã‚Šã‚“æ¡æ‰‹ä¼šã‚ãŸã£ãŸã®ï¼ï¼Ÿ"), "ã”ã‚ã‚“ã­ é–‹å ´ã¨é–‹æ¼”æ™‚é–“è¦‹é–“é•ãˆã¦ãŸã‹ã‚‰ã‚‚ã£ã¨çŸ­ã„ã‚„! ãã—ã¦ã‚ã„ã¡ã‚ƒã‚“ã´ã“ã‚Šã‚“æ¡æ‰‹ä¼šã‚ãŸã£ãŸã®!?");
    is($_->normalize("ãŠçˆ¶ã•ã‚“ãŒãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ãã‚Œã¾ã—ãŸâ™¡ã‹ã‚ã„ã„ã£(*^_^*)ã“ã‚Œå±¥ã„ã¦ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã—ã‚ˆã†ï¼"), "ãŠçˆ¶ã•ã‚“ãŒãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ãã‚Œã¾ã—ãŸ ã‹ã‚ã„ã„ ã“ã‚Œå±¥ã„ã¦ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã—ã‚ˆã†!");
    is($_->normalize("ã‚«ãƒ¯ã‚¤ã‚¤â€¦ã‚„ã£ãŸã­!æ°—æŒã¡ã‚‚ä¸ŠãŒã‚‹ã­o(^o^)o"), "ã‚«ãƒ¯ã‚¤ã‚¤â€¦â€¦ã‚„ã£ãŸã­!æ°—æŒã¡ã‚‚ä¸ŠãŒã‚‹ã­");
    is($_->normalize("ã»ãˆ ((((ï¼›ï¾ŸĞ”ï¾Ÿ)))))))ï½±ï¾œï¾œ"), "ã»ãˆ");
    is($_->normalize("æŠŠæ¡ã—ãŸâ€¦www  #æ¨ã—ã”ã¨ãŠç–²ã‚Œæ§˜ã§ã—ãŸw"), "æŠŠæ¡ã—ãŸâ€¦â€¦ \x{1F60A}");
    #is($_->normalize("ãŠã¯ã‚ˆãƒ¼ï¼ ã£ã¦å‘Ÿã„ã¦ã‚‚èª°ã‹ã‚‰ã‚‚ãƒªãƒ—æ¥ãªã„L(â€™Ï‰â€™)â”˜ä¸‰â””(â€™Ï‰â€™)ã€"), "ãŠã¯ã‚ˆãƒ¼ï¼ ã£ã¦å‘Ÿã„ã¦ã‚‚èª°ã‹ã‚‰ã‚‚ãƒªãƒ—æ¥ãªã„");
    is($_->normalize("ã‚ã‚ŠãŒã¨ã‚“wã‚ã‚„ãŸã‚“ã¯å¹´ä¸Šâ‡ä¸‹â‡"), "ã‚ã‚ŠãŒã¨ã‚“wã‚ã‚„ãŸã‚“ã¯å¹´ä¸Š??ä¸‹??");
    is($_->normalize("ã‚ã‚„ãŸã‚“ã„ã£ã“ã—ãŸï¼ï¼ï¼ã‹ãªï¼Ÿï¼Ÿ é«˜3ã«ãªã‚Šã¾ã—ãŸâ”€=â‰¡Î£((( ã¤â€¢Ì€Ï‰â€¢Ì)ã¤"), "ã‚ã‚„ãŸã‚“ã„ã£ã“ã—ãŸ!!ã‹ãª?? é«˜3ã«ãªã‚Šã¾ã—ãŸãƒ¼");
    is($_->normalize("ç©ºæƒ³å§”å“¡ä¼šï¼¼(^o^)ï¼  ãƒãƒ•ãƒ©ãƒ¼å°‘å¥³ã§ã‚†ã£ãŸã‚Šã—ã¦ã‚‹ğŸ’“ğŸ’“"), "ç©ºæƒ³å§”å“¡ä¼š ãƒãƒ•ãƒ©ãƒ¼å°‘å¥³ã§ã‚†ã£ãŸã‚Šã—ã¦ã‚‹");
    is($_->normalize("è“®ãƒ¡ã‚¤ç´ æ•µã§ã™ã…///"), "è“®ãƒ¡ã‚¤ç´ æ•µã§ã™ã…");
    is($_->normalize("ãªã‚“ã§ã‚„ï½¯ ã«ã‚ƒ"), "ãªã‚“ã§ã‚„ ã«ã‚ƒ");
};

done_testing;
